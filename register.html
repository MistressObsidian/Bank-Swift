<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Register â€¢ Bank Swift</title>
  <link rel="stylesheet" href="ui.css" />
  <link rel="icon" href="bank-swift.png" type="image/png" />
  <link rel="apple-touch-icon" href="bank-swift.png" />
  <link rel="shortcut icon" href="bank-swift.png" type="image/png" />
  <style>/* Minor page tweak */ .auth-wrapper{padding-top:120px;} </style>
</head>
<body>
  <script src="common.js"></script>
  
  <div class="hero-background"></div>
  <div class="particles" id="particles"></div>
  <main class="auth-wrapper">
    <section class="auth-card" aria-labelledby="regTitle">
      <div class="auth-head">
        <div class="auth-logo" aria-hidden="true">
          <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="logoGrad1" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#667eea"/><stop offset="60%" stop-color="#764ba2"/><stop offset="100%" stop-color="#8b5cf6"/></linearGradient><linearGradient id="logoGrad2" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#06b6d4"/><stop offset="100%" stop-color="#4facfe"/></linearGradient><linearGradient id="logoGrad3" x1="0%" y1="100%" x2="100%" y2="0%"><stop offset="0%" stop-color="#f093fb" stop-opacity="0.8"/><stop offset="100%" stop-color="#f5576c" stop-opacity="0.8"/></linearGradient></defs><path fill="url(#logoGrad1)" d="M6 10 L34 32 L6 54 Z"/><path fill="url(#logoGrad2)" d="M34 10 L58 32 L34 54 L22 44 L34 32 L22 20 Z"/><path fill="url(#logoGrad3)" d="M6 10 L34 32 L22 44 L6 54 Z" opacity="0.35"/></svg>
        </div>
        <h1 class="auth-title" id="regTitle">Create your account</h1>
        <p class="auth-sub">Join the future of digital banking in seconds</p>
      </div>
      <div id="regAlert" class="alert-auth" role="alert"></div>
      <form id="registerForm" class="form-grid" novalidate autocomplete="off">
        <div class="form-row-2">
          <div class="field">
            <label for="fullname">Full Name</label>
            <input class="input-base" id="fullname" name="fullname" placeholder="Jane Doe" required />
          </div>
          <div class="field">
            <label for="phone">Phone (optional)</label>
            <input class="input-base" id="phone" name="phone" inputmode="tel" placeholder="+1 555 123 4567" />
          </div>
        </div>
        <div class="field">
          <label for="email">Email</label>
          <input class="input-base" type="email" id="email" name="email" autocomplete="email" placeholder="you@example.com" required />
        </div>
        <div class="field">
          <label for="password">Password</label>
          <input class="input-base" type="password" id="password" name="password" minlength="6" placeholder="Minimum 6 characters" required />
        </div>
        <button type="submit" class="btn-full" id="registerBtn">Create Account</button>
      </form>
      <div class="auth-alt">Already have an account? <a href="login.html">Sign in</a></div>
    </section>
  </main>

  <script>
  function showAlert(msg, type = 'error') { const el = document.getElementById('regAlert'); el.textContent = msg; el.className = `alert-auth ${type} show`; }
  function clearAlert() { const el = document.getElementById('regAlert'); el.textContent=''; el.className='alert-auth'; }

    // Clear form on load
    document.addEventListener('DOMContentLoaded', () => {
      ['fullname','phone','email','password'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.value = '';
      });
    });

    document.getElementById('registerForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      clearAlert();

      const btn = document.getElementById('registerBtn');
      const originalText = btn.textContent;
      btn.disabled = true;
      btn.innerHTML = 'Creating account <span class="spinner"></span>';

      const fullname = document.getElementById('fullname').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const email = document.getElementById('email').value.trim().toLowerCase();
      const password = document.getElementById('password').value;

      // Basic validation
      if (!fullname || !email || !password) {
        showAlert('Please fill all required fields.');
        btn.disabled = false;
        btn.textContent = originalText;
        return;
      }

      if (password.length < 6) {
        showAlert('Password must be at least 6 characters.');
        btn.disabled = false;
        btn.textContent = originalText;
        return;
      }

      if (!email.includes('@')) {
        showAlert('Please enter a valid email address.');
        btn.disabled = false;
        btn.textContent = originalText;
        return;
      }

      try {
        // Check if email already exists
        const existing = await Platform.sheetSearch({
          formType: 'Registration',
          email: email
        });

        if (Array.isArray(existing) && existing.length > 0) {
          showAlert('This email is already registered. Please login instead.');
          btn.disabled = false;
          btn.textContent = originalText;
          return;
        }

        // Create new user record
        const nowISO = new Date().toISOString();
        const newUser = {
          formType: 'Registration',
          date: nowISO,
          fullname: fullname,
          email: email,
          phone: phone,
          password: password,
          baseAvailable: 0,  // New users start with zero balance
          totalBalance: 0     // New users start with zero balance
        };

        // Insert to SheetDB
        const success = await Platform.sheetInsert([newUser]);

        if (!success) {
          showAlert('Registration failed. Please try again.');
          btn.disabled = false;
          btn.textContent = originalText;
          return;
        }

        // Create session
        const sessionUser = {
          name: fullname,
          email: email,
          phone: phone,
          registrationDate: nowISO,
          isAuthenticated: true,
          loginTime: new Date().toISOString(),
          isNewUser: true  // Flag to identify newly registered users
        };

        // Clear any existing transaction data for fresh start
        sessionStorage.removeItem('initiatedTransactions');
        
        Platform.setUser(sessionUser);
        
        // Show success message
  showAlert('Account created successfully! Redirecting...', 'success');
        
        // Redirect to dashboard
        setTimeout(() => {
          window.location.href = 'dashboard.html';
        }, 1500);

      } catch (err) {
        console.error('Registration error:', err);
  showAlert('Could not complete registration. Please try again.');
        btn.disabled = false;
        btn.textContent = originalText;
      }
    });
    // Particles creation
    (function makeParticles(){ const c=document.getElementById('particles'); if(!c) return; for(let i=0;i<48;i++){ const p=document.createElement('span'); p.className='particle'; p.style.left=Math.random()*100+'%'; p.style.animationDelay=(Math.random()*16)+'s'; p.style.opacity=Math.random().toString(); c.appendChild(p);} })();
  </script>
</body>
</html>